
-- 1) CREATE TABLES
CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total_amount DECIMAL(10,2)
);

CREATE TABLE payments (
    payment_id INT PRIMARY KEY,
    order_id INT,
    payment_date DATE,
    amount DECIMAL(10,2)
);


INSERT INTO orders VALUES
(101, 1, '2024-01-10', 2500.00),
(102, 2, '2024-01-12', 1800.00),
(103, 1, '2024-01-15', 3200.00),
(104, 3, '2024-01-20', 1500.00),
(105, 4, '2024-01-25', 4000.00);

INSERT INTO payments VALUES
(1, 101, '2024-01-11', 2500.00),
(2, 102, '2024-01-13', 1000.00),
(3, 102, '2024-01-14', 800.00),
(4, 103, '2024-01-16', 3200.00),
(5, 105, '2024-01-26', 2000.00);



-- All orders
SELECT * FROM orders;

-- Orders above 2000
SELECT * FROM orders
WHERE total_amount > 2000;

-- Orders between amounts
SELECT * FROM orders
WHERE total_amount BETWEEN 1500 AND 3000;

-- Orders for specific customers
SELECT * FROM orders
WHERE customer_id IN (1, 3);


-- Order by amount (ascending)
SELECT * FROM orders
ORDER BY total_amount ASC;

-- Order by date (descending)
SELECT * FROM orders
ORDER BY order_date DESC;


-- Total revenue
SELECT SUM(total_amount) AS total_revenue
FROM orders;

-- Average order value
SELECT AVG(total_amount) AS avg_order_value
FROM orders;

-- Count total orders
SELECT COUNT(order_id) AS total_orders
FROM orders;


-- Total order value per customer
SELECT customer_id, SUM(total_amount) AS customer_total
FROM orders
GROUP BY customer_id;

-- Customers with spending > 3000
SELECT customer_id, SUM(total_amount) AS customer_total
FROM orders
GROUP BY customer_id
HAVING SUM(total_amount) > 3000;


-- INNER JOIN
SELECT o.order_id, o.customer_id, o.total_amount,
       p.payment_id, p.amount
FROM orders o
INNER JOIN payments p
ON o.order_id = p.order_id;

-- LEFT JOIN (all orders)
SELECT o.order_id, o.total_amount, p.amount
FROM orders o
LEFT JOIN payments p
ON o.order_id = p.order_id;

-- RIGHT JOIN (all payments)
SELECT o.order_id, o.total_amount, p.amount
FROM orders o
RIGHT JOIN payments p
ON o.order_id = p.order_id;

-- FULL JOIN (MySQL using UNION)
SELECT o.order_id, o.total_amount, p.amount
FROM orders o
LEFT JOIN payments p ON o.order_id = p.order_id
UNION
SELECT o.order_id, o.total_amount, p.amount
FROM orders o
RIGHT JOIN payments p ON o.order_id = p.order_id;


-- Orders above average order value
SELECT *
FROM orders
WHERE total_amount > (SELECT AVG(total_amount) FROM orders);

-- Highest order value
SELECT *
FROM orders
WHERE total_amount = (SELECT MAX(total_amount) FROM orders);

-- Orders with total payment < order amount (partial payment)
SELECT *
FROM orders
WHERE order_id IN (
    SELECT order_id
    FROM payments
    GROUP BY order_id
    HAVING SUM(amount) < (
        SELECT total_amount
        FROM orders
        WHERE orders.order_id = payments.order_id
    )
);


-- Payment status
SELECT o.order_id, o.total_amount,
       IFNULL(SUM(p.amount), 0) AS paid_amount,
CASE
    WHEN IFNULL(SUM(p.amount), 0) = o.total_amount THEN 'Paid'
    WHEN IFNULL(SUM(p.amount), 0) = 0 THEN 'Unpaid'
    ELSE 'Partially Paid'
END AS payment_status
FROM orders o
LEFT JOIN payments p
ON o.order_id = p.order_id
GROUP BY o.order_id;


-- View for order-payment summary
CREATE VIEW order_payment_summary AS
SELECT o.order_id, o.customer_id, o.total_amount,
       IFNULL(SUM(p.amount), 0) AS paid_amount
FROM orders o
LEFT JOIN payments p
ON o.order_id = p.order_id
GROUP BY o.order_id;

-- Use the view
SELECT * FROM order_payment_summary;


